<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: pages/Transfert/Transfert.jsx</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: pages/Transfert/Transfert.jsx</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import React, { useEffect, useState } from 'react';
import BeneficiaryCard from "../../components/beneficiary/BeneficiaryCard.jsx";
import BeneficiaryModal from "../../components/beneficiary/benificiaryModal.jsx";
import TransferModal from "../../components/transfer/TransferModalSpec.jsx";
import SearchBar from "../../components/beneficiary/SearchBar.jsx";
import Cookies from "js-cookie";
import axios from "axios";
import "../../pages/Beneficiary/Beneficiary.css";

/**
 * Page de transfert
 * 
 * Permet de :
 * - Sélectionner le compte source
 * - Sélectionner un bénéficiaire ou compte destinataire
 * - Effectuer un virement
 * - Ajouter de nouveaux bénéficiaires
 */
export default function Transfert() {
    const [beneficiaries, setBeneficiaries] = useState([]);
    const [account, setAccounts] = useState([]);
    const [user, setUser] = useState(null);

    const [query, setQuery] = useState("");

    const [isSecondOpen, setIsSecondOpen] = useState(false);
    const [isPopupOpen, setIsPopupOpen] = useState(false);
    const [isPopupOpen2, setIsPopupOpen2] = useState(false);

    const [selectedAccountId, setSelectedAccountId] = useState(null);
    const [selectedBeneficiaryRib, setSelectedBeneficiaryRib] = useState(null);

    const token = Cookies.get("access_token");

    // Récupère l'utilisateur, les comptes et les bénéficiaires
    useEffect(() => {
        const fetchData = async () => {
            const savedUser = localStorage.getItem("user");
            if (savedUser) setUser(JSON.parse(savedUser));

            if (!token) return;

            try {
                // Récupération des comptes de l'utilisateur
                const res = await axios.get("http://127.0.0.1:8000/accounts/", {
                    headers: { Authorization: `Bearer ${token}` },
                });
                setAccounts(res.data);

                // Récupération des bénéficiaires du compte principal
                const mainAccount = res.data.find((b) => b.main);
                if (!mainAccount) return;

                const res2 = await axios.get(
                    `http://127.0.0.1:8000/accounts/beneficiary/${mainAccount.id}`,
                    { headers: { Authorization: `Bearer ${token}` } }
                );
                setBeneficiaries(res2.data);
            } catch (err) {
                console.error("Erreur chargement des comptes ou bénéficiaires :", err.response?.data || err.message);
            }
        };

        fetchData();
    }, [token]);

    if (!user) {
        return (
            &lt;div className="welcome-section">
                &lt;h1>Bienvenue sur Votre Banque&lt;/h1>
                &lt;p>Connectez-vous pour accéder à vos comptes ou créez un compte.&lt;/p>
            &lt;/div>
        );
    }

    // Fonctions pour gérer l'affichage des modals
    const openPopup = () => setIsPopupOpen(true);
    const closePopup = () => setIsPopupOpen(false);
    const openPopup2 = () => setIsPopupOpen2(true);
    const closePopup2 = () => setIsPopupOpen2(false);

    const appearSecond = () => setIsSecondOpen(true);

    // Compte principal
    const main_account = account.find((b) => b.main);
    const current_account = main_account ? main_account.id : null;

    // Filtrage des bénéficiaires selon la recherche
    const filteredBeneficiaries = beneficiaries.filter((b) =>
        b.name.toLowerCase().includes(query.toLowerCase())
    );

    return (
        &lt;section>
            &lt;div className="center">
                &lt;SearchBar query={query} setQuery={setQuery} />

                {/* Sélection du compte source */}
                &lt;div className="from" style={{ display: isSecondOpen ? "none" : "block" }}>
                    &lt;div className="list">
                        &lt;h2>Depuis ...&lt;/h2>
                        {account.map((b) => (
                            &lt;BeneficiaryCard
                                key={b.id}
                                name={b.type}
                                iban={b.rib}
                                imgUrl={b.img}
                                onClick={() => { setSelectedAccountId(b.id); appearSecond(); }}
                            />
                        ))}
                    &lt;/div>
                &lt;/div>

                {/* Sélection du bénéficiaire */}
                &lt;div className="to" id="to" style={{ display: isSecondOpen ? "block" : "none" }}>
                    &lt;div className="list">
                        {filteredBeneficiaries.length === 0 || !query ? (
                            &lt;>
                                &lt;h2>Vers ...&lt;/h2>
                                &lt;h3>Vos comptes&lt;/h3>
                                {account.map((b) => (
                                    &lt;BeneficiaryCard
                                        key={b.id}
                                        name={b.type}
                                        iban={b.rib}
                                        imgUrl={b.img}
                                        onClick={() => { setSelectedBeneficiaryRib(b.rib); openPopup2(); }}
                                    />
                                ))}

                                &lt;h3>Vos Bénéficiaires&lt;/h3>
                                {beneficiaries.length === 0 ? (
                                    &lt;p>Il n'y a pas de bénéficiaire.&lt;/p>
                                ) : (
                                    beneficiaries.map((b) => (
                                        &lt;BeneficiaryCard
                                            key={b.id}
                                            name={b.name}
                                            iban={b.rib}
                                            imgUrl={b.img}
                                            onClick={() => { setSelectedBeneficiaryRib(b.rib); openPopup2(); }}
                                        />
                                    ))
                                )}
                            &lt;/>
                        ) : (
                            &lt;>
                                &lt;h2>Vous recherchez : "{query}" ...&lt;/h2>
                                {filteredBeneficiaries.map((b) => (
                                    &lt;BeneficiaryCard
                                        key={b.id}
                                        name={b.name}
                                        iban={b.rib}
                                        imgUrl={b.img}
                                        onClick={() => { setSelectedBeneficiaryRib(b.rib); openPopup2(); }}
                                    />
                                ))}
                            &lt;/>
                        )}
                    &lt;/div>
                &lt;/div>
            &lt;/div>

            &lt;button className="fixed_button" onClick={openPopup}>Ajouter un IBAN&lt;/button>

            {/* Modals */}
            &lt;BeneficiaryModal
                isOpen={isPopupOpen}
                onClose={closePopup}
                accountId={current_account}
                title="Ajouter un Bénéficiaire"
            />

            &lt;TransferModal
                isOpen={isPopupOpen2}
                onClose={closePopup2}
                accountId={selectedAccountId}
                rib={selectedBeneficiaryRib}
                title="Faire un nouveau virement"
            />
        &lt;/section>
    );
}
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#formatDate">formatDate</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.5</a> on Fri Dec 19 2025 10:23:55 GMT+0100 (heure normale d’Europe centrale)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
